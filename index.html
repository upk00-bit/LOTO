<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>LÃ´ TÃ´ Game</title>

<style>
body { font-family: Arial; padding: 20px; }

button { padding: 6px 12px; margin-right: 8px; }

.ticket {
  display: grid;
  grid-template-columns: repeat(9, 42px);
  gap: 4px;
}

.cell {
  height: 42px;
  border: 1px solid #ccc;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

.cell.marked {
  background: gold;
}

.cell .dot {
  position: absolute;
  bottom: 4px;
  right: 4px;
  width: 8px;
  height: 8px;
  background: red;
  border-radius: 50%;
}

.row-4 {
  background: #ffd6d6;
}

.row-5 {
  background: gold;
}

.board {
  display: grid;
  grid-template-columns: repeat(10, 30px);
  gap: 4px;
  margin-top: 12px;
}

.called { background: lightgreen; }
</style>
</head>

<body>

<h1>ðŸŽ² LÃ´ TÃ´ Game</h1>

<h2 id="current">Sá»‘ hiá»‡n táº¡i: -</h2>
<button onclick="callNumber()">ðŸŽ¯ Bá»‘c sá»‘</button>
<button onclick="startNewRound()">ðŸ”„ VÃ¡n má»›i</button>

<h3>ðŸŽŸ VÃ© cá»§a báº¡n</h3>
<div id="ticket" class="ticket"></div>

<h3>ðŸ“‹ Board</h3>
<div id="board" class="board"></div>

<script>
/* ================= CONFIG ================= */
const COL_RANGES = [
  [1,9],[10,19],[20,29],[30,39],[40,49],
  [50,59],[60,69],[70,79],[80,90]
]

/* ================= STATE ================= */
let ticket = null
let calledNumbers = []
let gameEnded = false

/* ================= GENERATE TICKET ================= */
function generateTicket() {
  const grid = Array.from({ length: 9 }, () => Array(9).fill(null))
  const marked = Array.from({ length: 9 }, () => Array(9).fill(false))

  COL_RANGES.forEach(([min, max], col) => {
    const pool = shuffle(range(min, max)).slice(0, 9)
    for (let r = 0; r < 9; r++) grid[r][col] = pool[r]
  })

  for (let r = 0; r < 9; r++) {
    shuffle(range(0, 8)).slice(0, 4).forEach(c => grid[r][c] = null)
  }

  return { grid, marked }
}

/* ================= INIT ================= */
function initGame() {
  ticket = generateTicket()
  calledNumbers = []
  gameEnded = false
  renderTicket()
  renderBoard()
}

/* ================= RENDER ================= */
function renderTicket() {
  const el = document.getElementById('ticket')
  el.innerHTML = ''

  ticket.grid.forEach((row, r) => {
    const rowCells = []

    row.forEach((num, c) => {
      const d = document.createElement('div')
      d.className = 'cell'

      if (ticket.marked[r][c]) d.classList.add('marked')

      // gá»£i Ã½ sá»‘ Ä‘Ã£ gá»i báº±ng cháº¥m nhá»
      if (num && calledNumbers.includes(num)) {
        const dot = document.createElement('div')
        dot.className = 'dot'
        d.appendChild(dot)
      }

      d.innerText = num ?? ''

      d.onclick = () => {
        if (!num) return
        ticket.marked[r][c] = !ticket.marked[r][c]
        renderTicket()
      }

      rowCells.push(d)
    })

    // check row
    const numsInRow = row.filter(n => n !== null)
    const calledInRow = numsInRow.filter(n => calledNumbers.includes(n)).length

    if (calledInRow === 4) rowCells.forEach(c => c.classList.add('row-4'))
    if (calledInRow === 5) {
      rowCells.forEach(c => c.classList.add('row-5'))
      if (!gameEnded) endGame()
    }

    rowCells.forEach(c => el.appendChild(c))
  })
}

function renderBoard() {
  const el = document.getElementById('board')
  el.innerHTML = ''
  for (let i = 1; i <= 90; i++) {
    const d = document.createElement('div')
    d.className = 'cell'
    if (calledNumbers.includes(i)) d.classList.add('called')
    d.innerText = i
    el.appendChild(d)
  }
}

/* ================= GAME LOGIC ================= */
function callNumber() {
  if (gameEnded) return alert('VÃ¡n Ä‘Ã£ káº¿t thÃºc')

  const remain = range(1, 90).filter(n => !calledNumbers.includes(n))
  if (!remain.length) return alert('Háº¿t sá»‘')

  const n = remain[Math.floor(Math.random() * remain.length)]
  calledNumbers.push(n)
  document.getElementById('current').innerText = 'Sá»‘ hiá»‡n táº¡i: ' + n
  renderTicket()
  renderBoard()
}

function endGame() {
  gameEnded = true
  setTimeout(() => {
    alert('ðŸŽ‰ KINH! VÃN CHÆ I Káº¾T THÃšC')
  }, 100)
}

function startNewRound() {
  initGame()
  document.getElementById('current').innerText = 'Sá»‘ hiá»‡n táº¡i: -'
}

/* ================= UTILS ================= */
function range(min, max) {
  return Array.from({ length: max - min + 1 }, (_, i) => i + min)
}
function shuffle(arr) {
  return arr.sort(() => Math.random() - 0.5)
}

/* ================= START ================= */
initGame()
</script>

</body>
</html>
