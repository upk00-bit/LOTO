<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>LÃ´ TÃ´ Game</title>
  <style>
    body { font-family: Arial; padding: 20px }
    .ticket { display: grid; grid-template-columns: repeat(9, 40px); gap: 4px; }
    .cell {
      height: 40px;
      border: 1px solid #ccc;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
    }
    .marked { background: gold }
    .board { display: grid; grid-template-columns: repeat(10, 30px); gap: 4px }
    .called { background: lightgreen }
  </style>
</head>
<body>

<h1>LÃ´ TÃ´ Game</h1>

<h2 id="current">Sá»‘ hiá»‡n táº¡i: -</h2>

<button onclick="callNumber()">ðŸŽ¯ Bá»‘c sá»‘</button>
<button onclick="startNewRound()">ðŸ”„ Báº¯t Ä‘áº§u vÃ¡n má»›i</button>

<h3>VÃ© cá»§a báº¡n</h3>
<div id="ticket" class="ticket"></div>

<h3>Board 1â€“90</h3>
<div id="board" class="board"></div>

<script>
  const COL_RANGES = [
    [1,9],[10,19],[20,29],[30,39],[40,49],
    [50,59],[60,69],[70,79],[80,90]
  ]

  let ticket = generateTicket()
  let calledNumbers = []

  function generateTicket() {
    const grid = Array.from({ length: 9 }, () => Array(9).fill(null))
    const marked = Array.from({ length: 9 }, () => Array(9).fill(false))

    for (let r = 0; r < 9; r++) {
      const cols = shuffle([...Array(9).keys()]).slice(0, 5)
      cols.forEach(c => {
        const [min, max] = COL_RANGES[c]
        grid[r][c] = rand(min, max)
      })
    }

    return { grid, marked }
  }

  function renderTicket() {
    const el = document.getElementById('ticket')
    el.innerHTML = ''
    ticket.grid.forEach((row, r) => {
      row.forEach((num, c) => {
        const d = document.createElement('div')
        d.className = 'cell'
        if (ticket.marked[r][c]) d.classList.add('marked')
        d.innerText = num ?? ''
        d.onclick = () => {
          if (num && calledNumbers.includes(num)) {
            ticket.marked[r][c] = true
            renderTicket()
          }
        }
        el.appendChild(d)
      })
    })
  }

  function renderBoard() {
    const el = document.getElementById('board')
    el.innerHTML = ''
    for (let i = 1; i <= 90; i++) {
      const d = document.createElement('div')
      d.className = 'cell'
      if (calledNumbers.includes(i)) d.classList.add('called')
      d.innerText = i
      el.appendChild(d)
    }
  }

  function callNumber() {
    const remain = Array.from({ length: 90 }, (_, i) => i + 1)
      .filter(n => !calledNumbers.includes(n))

    if (!remain.length) return alert('Háº¿t sá»‘!')

    const n = remain[Math.floor(Math.random() * remain.length)]
    calledNumbers.push(n)
    document.getElementById('current').innerText = 'Sá»‘ hiá»‡n táº¡i: ' + n
    renderBoard()
  }

  // âœ… FIX BUG: reset Ã´ Ä‘Ã£ tÃ´
  function startNewRound() {
    calledNumbers = []
    ticket.marked = Array.from({ length: 9 }, () => Array(9).fill(false))
    document.getElementById('current').innerText = 'Sá»‘ hiá»‡n táº¡i: -'
    renderTicket()
    renderBoard()
  }

  function rand(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min
  }

  function shuffle(arr) {
    return arr.sort(() => Math.random() - 0.5)
  }

  renderTicket()
  renderBoard()
</script>

</body>
</html>
