<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<title>L√¥ T√¥ Game</title>
<style>
body { font-family: Arial; padding: 20px }
.ticket { display: grid; grid-template-columns: repeat(9, 40px); gap: 4px; }
.cell {
  height: 40px;
  border: 1px solid #ccc;
  display: flex;
  justify-content: center;
  align-items: center;
}
.marked { background: gold }
.called { background: lightgreen }
.locked { opacity: .4 }
.ticket-wrap { border: 2px solid #999; padding: 8px }
.ticket-wrap.selected { border-color: blue }
.board { display: grid; grid-template-columns: repeat(10, 30px); gap: 4px }
button { margin-right: 8px }
</style>
</head>
<body>

<h1>L√¥ T√¥ Game</h1>

<h2 id="current">S·ªë hi·ªán t·∫°i: -</h2>
<button onclick="callNumber()">üéØ B·ªëc s·ªë</button>
<button onclick="startNewRound()">üîÑ V√°n m·ªõi</button>

<h3>Ch·ªçn v√©</h3>
<div id="tickets"></div>

<h3>Board</h3>
<div id="board" class="board"></div>

<script>
const COL_RANGES = [
  [1,9],[10,19],[20,29],[30,39],[40,49],
  [50,59],[60,69],[70,79],[80,90]
]

let tickets = []
let selectedTicket = null
let calledNumbers = []

// ---------------- TICKET GENERATOR (NO DUPLICATE) ----------------
function generateTicket() {
  const grid = Array.from({ length: 9 }, () => Array(9).fill(null))
  const marked = Array.from({ length: 9 }, () => Array(9).fill(false))

  COL_RANGES.forEach(([min, max], col) => {
    const pool = shuffle(range(min, max)).slice(0, 9)
    for (let row = 0; row < 9; row++) {
      grid[row][col] = pool[row]
    }
  })

  // m·ªói h√†ng ch·ªâ gi·ªØ 5 s·ªë
  for (let r = 0; r < 9; r++) {
    const remove = shuffle([...Array(9).keys()]).slice(0, 4)
    remove.forEach(c => grid[r][c] = null)
  }

  return { grid, marked, locked: false }
}

// ---------------- INIT 20 TICKETS ----------------
function initTickets() {
  tickets = Array.from({ length: 20 }, generateTicket)
  selectedTicket = null
  renderTickets()
}

// ---------------- RENDER ----------------
function renderTickets() {
  const el = document.getElementById('tickets')
  el.innerHTML = ''

  tickets.forEach((t, i) => {
    const wrap = document.createElement('div')
    wrap.className = 'ticket-wrap'
    if (t.locked) wrap.classList.add('locked')
    if (t === selectedTicket) wrap.classList.add('selected')

    wrap.onclick = () => {
      if (t.locked) return
      tickets.forEach(x => x.locked = false)
      t.locked = true
      selectedTicket = t
      renderTickets()
    }

    const grid = document.createElement('div')
    grid.className = 'ticket'

    t.grid.forEach((row, r) =>
      row.forEach((num, c) => {
        const d = document.createElement('div')
        d.className = 'cell'
        if (t.marked[r][c]) d.classList.add('marked')
        d.innerText = num ?? ''
        grid.appendChild(d)
      })
    )

    wrap.appendChild(grid)
    el.appendChild(wrap)
  })
}

function renderBoard() {
  const el = document.getElementById('board')
  el.innerHTML = ''
  for (let i = 1; i <= 90; i++) {
    const d = document.createElement('div')
    d.className = 'cell'
    if (calledNumbers.includes(i)) d.classList.add('called')
    d.innerText = i
    el.appendChild(d)
  }
}

// ---------------- GAME LOGIC ----------------
function callNumber() {
  if (!selectedTicket) return alert('H√£y ch·ªçn v√© tr∆∞·ªõc')

  const remain = range(1, 90).filter(n => !calledNumbers.includes(n))
  if (!remain.length) return alert('H·∫øt s·ªë')

  const n = remain[Math.floor(Math.random() * remain.length)]
  calledNumbers.push(n)
  document.getElementById('current').innerText = 'S·ªë hi·ªán t·∫°i: ' + n

  // ‚úÖ AUTO SCAN & MARK
  selectedTicket.grid.forEach((row, r) =>
    row.forEach((num, c) => {
      if (num === n) selectedTicket.marked[r][c] = true
    })
  )

  renderTickets()
  renderBoard()
}

// ---------------- RESET ROUND ----------------
function startNewRound() {
  calledNumbers = []
  tickets.forEach(t =>
    t.marked = Array.from({ length: 9 }, () => Array(9).fill(false))
  document.getElementById('current').innerText = 'S·ªë hi·ªán t·∫°i: -'
  renderTickets()
  renderBoard()
}

// ---------------- UTILS ----------------
function range(min, max) {
  return Array.from({ length: max - min + 1 }, (_, i) => i + min)
}
function shuffle(arr) {
  return arr.sort(() => Math.random() - 0.5)
}

// ---------------- INIT ----------------
initTickets()
renderBoard()
</script>

</body>
</html>
