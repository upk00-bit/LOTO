<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>L√¥ T√¥ 9x9</title>

<style>
body {
  font-family: Arial;
  text-align: center;
}

table {
  border-collapse: collapse;
  margin: 15px auto;
  border: 5px solid black;
}

td {
  width: 50px;
  height: 50px;
  border: 2px solid black;
  text-align: center;
  font-weight: bold;
  cursor: pointer;
}

.marked {
  background: #ffeb3b;
}

select {
  font-size: 16px;
  padding: 6px;
}
</style>
</head>

<body>

<h2>Ch·ªçn t·ªù l√¥ t√¥</h2>
<select id="boardSelect"></select>

<table id="board"></table>

<script>
/* ================== CONFIG ================== */
const COLORS = [
  "#f97316", "#facc15", "#ec4899", "#ef4444", "#22c55e",
  "#3b82f6", "#92400e", "#8b5cf6", "#14b8a6", "#64748b",
  "#a855f7", "#fb7185", "#84cc16", "#06b6d4", "#f59e0b",
  "#6366f1", "#dc2626", "#16a34a", "#9333ea", "#0ea5e9"
];

const BOARD_KEY = "LOTO_20_BOARDS";
const LOCK_KEY  = "LOTO_LOCKED_TICKETS";
const PLAYER_KEY = "LOTO_PLAYER_BOARD";

/* ================== LOAD DATA ================== */
let boards = JSON.parse(localStorage.getItem(BOARD_KEY));
let lockedBoards = JSON.parse(localStorage.getItem(LOCK_KEY)) || [];
let myBoard = localStorage.getItem(PLAYER_KEY);

/* ================== UTIL ================== */
function getColRange(col) {
  if (col === 8) return [80, 90];
  return [col * 10 + 1, col * 10 + 9];
}

/* ================== GENERATE ================== */
function generateBoards() {
  let result = [];

  for (let b = 0; b < 20; b++) {
    let board = [];

    for (let r = 0; r < 9; r++) {
      let row = Array(9).fill("");
      let cols = [];

      while (cols.length < 5) {
        let c = Math.floor(Math.random() * 9);
        if (!cols.includes(c)) cols.push(c);
      }

      cols.forEach(c => {
        const [min, max] = getColRange(c);
        row[c] = Math.floor(Math.random() * (max - min + 1)) + min;
      });

      board.push(row);
    }

    result.push(board);
  }

  return result;
}

/* ================== INIT ================== */
if (!boards) {
  boards = generateBoards();
  localStorage.setItem(BOARD_KEY, JSON.stringify(boards));
}

/* ================== UI ================== */
const select = document.getElementById("boardSelect");
const table = document.getElementById("board");

/* build select */
boards.forEach((_, i) => {
  let opt = document.createElement("option");
  opt.value = i;
  opt.text = `T·ªù s·ªë ${i + 1}`;

  if (lockedBoards.includes(i) && myBoard != i) {
    opt.disabled = true;
    opt.text += " üîí";
  }

  select.appendChild(opt);
});

/* ================== SELECT BOARD ================== */
select.onchange = () => {
  const index = select.value;

  if (lockedBoards.includes(Number(index)) && myBoard != index) {
    alert("‚ùå T·ªù n√†y ƒë√£ c√≥ ng∆∞·ªùi ch·ªçn");
    return;
  }

  /* lock board */
  if (!lockedBoards.includes(Number(index))) {
    lockedBoards.push(Number(index));
    localStorage.setItem(LOCK_KEY, JSON.stringify(lockedBoards));
  }

  localStorage.setItem(PLAYER_KEY, index);
  loadBoard(index);
};

/* ================== LOAD BOARD ================== */
function loadBoard(index) {
  table.innerHTML = "";
  table.style.borderColor = COLORS[index];
  select.disabled = true;

  boards[index].forEach(row => {
    let tr = document.createElement("tr");

    row.forEach(cell => {
      let td = document.createElement("td");
      td.textContent = cell;
      td.style.borderColor = COLORS[index];
      td.onclick = () => td.classList.toggle("marked");
      tr.appendChild(td);
    });

    table.appendChild(tr);
  });
}

/* ================== AUTO LOAD MY BOARD ================== */
if (myBoard !== null) {
  select.value = myBoard;
  loadBoard(myBoard);
}
</script>

</body>
</html>
